<div class="grid">
      <div class="col-12">
        <p-card>
          <ng-template pTemplate="header">
            <div class="p-4">
              <h1 class="text-2xl font-bold mb-2">Quản lý người dùng</h1>
              <p class="text-gray-400">
                Quản lý tài khoản người dùng trong hệ thống
              </p>
            </div>
          </ng-template>

          <!-- Filters -->
          <form
            [formGroup]="filterForm"
            (ngSubmit)="applyFilters()"
            class="p-4 border-bottom-1 border-gray-700"
          >
            <div class="grid">
              <div class="col-12 md:col-3">
                <label class="block text-sm font-medium mb-2">Tìm kiếm</label>
                <input
                  pInputText
                  formControlName="q"
                  placeholder="Tên, email..."
                  class="w-full"
                />
              </div>

              <div class="col-12 md:col-3">
                <label class="block text-sm font-medium mb-2">Vai trò</label>
                <p-select
                  formControlName="role"
                  [options]="roleOptions"
                  placeholder="Tất cả"
                  class="w-full"
                >
                </p-select>
              </div>

              <div class="col-12 md:col-3">
                <label class="block text-sm font-medium mb-2">Trạng thái</label>
                <p-select
                  formControlName="status"
                  [options]="statusOptions"
                  placeholder="Tất cả"
                  class="w-full"
                >
                </p-select>
              </div>

              <div class="col-12 md:col-3 flex align-items-end gap-2">
                <p-button
                  type="submit"
                  label="Lọc"
                  icon="pi pi-filter"
                  class="p-button-outlined"
                >
                </p-button>
                <p-button
                  type="button"
                  label="Xóa bộ lọc"
                  icon="pi pi-times"
                  class="p-button-text"
                  (click)="clearFilters()"
                >
                </p-button>
              </div>
            </div>
          </form>

          <!-- Users Table -->
          <div class="p-4">
            <div *ngIf="isLoading; else usersContent">
              <div class="flex justify-content-center p-4">
                <p-progressSpinner
                  [style]="{ width: '50px', height: '50px' }"
                ></p-progressSpinner>
              </div>
            </div>

            <ng-template #usersContent>
              <p-table
                [value]="users"
                [paginator]="true"
                [rows]="pageSize"
                [totalRecords]="totalRecords"
                [lazy]="true"
                (onLazyLoad)="loadUsers($event)"
                styleClass="p-datatable-sm"
              >
                <ng-template pTemplate="header">
                  <tr>
                    <th>Tên</th>
                    <th>Email</th>
                    <th>Số điện thoại</th>
                    <th>Vai trò</th>
                    <th>Trạng thái</th>
                    <th>Ngày tạo</th>
                    <th>Thao tác</th>
                  </tr>
                </ng-template>

                <ng-template pTemplate="body" let-user>
                  <tr>
                    <td>{{ user.name }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.phone || '-' }}</td>
                    <td>
                      <p-tag
                        [value]="getRoleLabel(user.role)"
                        [severity]="getRoleSeverity(user.role)"
                      >
                      </p-tag>
                    </td>
                    <td>
                      <p-tag
                        [value]="getStatusLabel(user.status)"
                        [severity]="getStatusSeverity(user.status)"
                      >
                      </p-tag>
                    </td>
                    <td>{{ user.createdAt | date: 'dd/MM/yyyy HH:mm' }}</td>
                    <td>
                      <div class="flex gap-2">
                        <p-button
                          icon="pi pi-pencil"
                          class="p-button-sm p-button-outlined"
                          (click)="editUser(user)"
                          aria-label="Chỉnh sửa"
                        >
                        </p-button>
                        <p-button
                          icon="pi pi-envelope"
                          class="p-button-sm p-button-outlined"
                          (click)="resendVerification(user)"
                          aria-label="Gửi lại email xác thực"
                        >
                        </p-button>
                      </div>
                    </td>
                  </tr>
                </ng-template>

                <ng-template pTemplate="emptymessage">
                  <tr>
                    <td colspan="7" class="text-center p-4">
                      <div class="flex flex-column align-items-center gap-2">
                        <i class="pi pi-users text-4xl text-gray-400"></i>
                        <p class="text-gray-400">
                          Không tìm thấy người dùng nào
                        </p>
                      </div>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </ng-template>
          </div>
        </p-card>
      </div>
    </div>

    <p-confirmDialog></p-confirmDialog>