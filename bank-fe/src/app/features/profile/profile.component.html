<div class="profile-page">
  <!-- Hero Section -->
  <div class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">Hồ sơ cá nhân</h1>
      <p class="hero-subtitle">Quản lý thông tin tài khoản của bạn</p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="content-wrapper">
    <div class="profile-container">
      <!-- Profile Information Card -->
      <div class="profile-card">
        <div class="card-header">
          <div class="header-icon">
            <i class="pi pi-user"></i>
          </div>
          <div class="header-content">
            <h3 class="header-title">Thông tin cá nhân</h3>
            <p class="header-subtitle">Cập nhật thông tin cơ bản</p>
          </div>
        </div>

        <div class="card-body">
          @if (isLoadingProfile) {
            <div class="loading-container">
              <p-progressSpinner
                [style]="{ width: '50px', height: '50px' }"
              ></p-progressSpinner>
            </div>
          } @else {
            <!-- Display Mode -->
            @if (!isEditing) {
              <div class="profile-display">
              <div class="info-item">
                <label class="info-label">Họ và tên</label>
                <div class="info-value">
                  {{ currentProfile?.name || "Chưa cập nhật" }}
                </div>
              </div>

              <div class="info-item">
                <label class="info-label">Email</label>
                <div class="info-value">
                  {{ currentProfile?.email || "Chưa cập nhật" }}
                </div>
              </div>

              <div class="info-item">
                <label class="info-label">Số tài khoản</label>
                <div class="info-value">
                  {{ currentProfile?.accountNumber || "Chưa có" }}
                </div>
              </div>

              <div class="info-item">
                <label class="info-label">Số điện thoại</label>
                <div class="info-value">
                  {{ currentProfile?.phone || "Chưa cập nhật" }}
                </div>
              </div>

              <div class="info-item">
                <label class="info-label">Biệt danh</label>
                @if (currentProfile?.nickname) {
                  <div class="info-value">
                    <span>@{{ currentProfile?.nickname }}</span>
                  </div>
                } @else {
                  <div class="info-value">
                    <span class="text-muted">Chưa đặt</span>
                  </div>
                }
              </div>

              <button
                type="button"
                class="form-button primary"
                (click)="startEditing()"
              >
                <i class="pi pi-pencil"></i>
                <span>Chỉnh sửa</span>
              </button>
              </div>
            } @else {
              <!-- Edit Mode -->
              <form
                [formGroup]="profileForm"
                (ngSubmit)="updateProfile()"
                class="profile-form"
              >
                <div class="form-group">
                  <label class="form-label">Họ và tên</label>
                  <div class="readonly-field">
                    {{ currentProfile?.name || "Chưa cập nhật" }}
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">Email</label>
                  <div class="readonly-field">
                    {{ currentProfile?.email || "Chưa cập nhật" }}
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">Số tài khoản</label>
                  <div class="readonly-field">
                    {{ currentProfile?.accountNumber || "Chưa có" }}
                  </div>
                </div>

                <div class="form-group">
                  <label for="phone" class="form-label">Số điện thoại</label>
                  <input
                    id="phone"
                    type="text"
                    pInputText
                    formControlName="phone"
                    placeholder="Nhập số điện thoại"
                    class="form-input"
                  />
                  @if (profileForm.get('phone')?.invalid && profileForm.get('phone')?.touched) {
                    <small class="form-error">
                      Số điện thoại là bắt buộc
                    </small>
                  }
                </div>


                <div class="form-group">
                  <label for="newPassword" class="form-label"
                    >Mật khẩu mới</label
                  >
                  <p-password
                    id="newPassword"
                    formControlName="newPassword"
                    placeholder="Nhập mật khẩu mới (để trống nếu không muốn đổi)"
                    [feedback]="true"
                    [toggleMask]="true"
                    class="form-password"
                  >
                  </p-password>
                  @if (profileForm.get('newPassword')?.invalid && profileForm.get('newPassword')?.touched) {
                    <small class="form-error">
                      Mật khẩu mới phải có ít nhất 6 ký tự
                    </small>
                  }
                </div>

                <div class="form-actions">
                  <button
                    type="button"
                    class="form-button secondary"
                    (click)="cancelEditing()"
                  >
                    <i class="pi pi-times"></i>
                    <span>Hủy</span>
                  </button>

                  <button
                    type="submit"
                    class="form-button primary"
                    [disabled]="profileForm.invalid || isUpdatingProfile"
                  >
                    <i class="pi pi-save"></i>
                    <span>Cập nhật</span>
                    @if (isUpdatingProfile) {
                      <p-progressSpinner
                        [style]="{ width: '20px', height: '20px' }"
                      ></p-progressSpinner>
                    }
                  </button>
                </div>
              </form>
            }
          }
        </div>
      </div>

      <!-- Nickname Card -->
      @if (!currentProfile?.nickname) {
        <div class="nickname-card">
        <div class="card-header">
          <div class="header-icon">
            <i class="pi pi-at"></i>
          </div>
          <div class="header-content">
            <h3 class="header-title">Tạo biệt danh</h3>
            <p class="header-subtitle">Tạo nickname để dễ dàng nhận tiền</p>
          </div>
        </div>

        <div class="card-body">
          <div class="nickname-info">
            <p class="nickname-description">
              Biệt danh giúp người khác dễ dàng chuyển tiền cho bạn thay vì nhớ số tài khoản dài.
              <strong>Lưu ý: Biệt danh chỉ có thể tạo 1 lần duy nhất và không thể thay đổi.</strong>
            </p>

            <form [formGroup]="nicknameForm" (ngSubmit)="setNickname()" class="nickname-form">
              <div class="form-group">
                <label for="nickname" class="form-label">Biệt danh</label>
                <input
                  id="nickname"
                  type="text"
                  pInputText
                  formControlName="nickname"
                  placeholder="Nhập biệt danh (3-20 ký tự)"
                  class="form-input"
                  maxlength="20"
                />
                <small class="form-help">
                  Chỉ được chứa chữ cái, số và dấu gạch dưới
                </small>
                @if (nicknameForm.get('nickname')?.invalid && nicknameForm.get('nickname')?.touched) {
                  <small class="form-error">
                    @if (nicknameForm.get('nickname')?.errors?.['required']) {
                      <span>Biệt danh là bắt buộc</span>
                    }
                    @if (nicknameForm.get('nickname')?.errors?.['pattern']) {
                      <span>Biệt danh chỉ được chứa chữ cái, số và dấu gạch dưới</span>
                    }
                  </small>
                }
              </div>

              <button
                type="submit"
                class="form-button primary"
                [disabled]="nicknameForm.invalid || isSettingNickname"
              >
                <i class="pi pi-check"></i>
                <span>Tạo biệt danh</span>
                @if (isSettingNickname) {
                  <p-progressSpinner
                    [style]="{ width: '20px', height: '20px' }"
                  ></p-progressSpinner>
                }
              </button>
            </form>
          </div>
        </div>
        </div>
      }

      <!-- Logout Card -->
      <div class="logout-card">
        <div class="card-header">
          <div class="header-icon">
            <i class="pi pi-sign-out"></i>
          </div>
          <div class="header-content">
            <h3 class="header-title">Đăng xuất</h3>
            <p class="header-subtitle">Thoát khỏi tài khoản của bạn</p>
          </div>
        </div>

        <div class="card-body">
          <div class="logout-content">
            <p class="logout-description">
              Bạn có chắc chắn muốn đăng xuất khỏi tài khoản không?
            </p>

            <button type="button" class="form-button danger" (click)="logout()">
              <i class="pi pi-sign-out"></i>
              <span>Đăng xuất</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
