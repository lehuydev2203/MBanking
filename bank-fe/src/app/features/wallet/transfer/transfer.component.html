<div class="transfer-page">
  <!-- Hero Section -->
  <div class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">Chuyển khoản</h1>
      <p class="hero-subtitle">
        Chuyển tiền đến tài khoản khác một cách an toàn và nhanh chóng
      </p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="content-wrapper">
    <div class="transfer-content">
      <!-- Main Form -->
      <div class="form-section">
        <div class="form-card">
          <div class="card-header">
            <div class="header-icon">
              <i class="pi pi-send"></i>
            </div>
            <div class="header-content">
              <h3 class="header-title">Chuyển tiền đến tài khoản khác</h3>
              <p class="header-subtitle">
                Nhập thông tin người nhận và số tiền cần chuyển
              </p>
            </div>
          </div>

          <div class="card-content">
            <form
              [formGroup]="transferForm"
              (ngSubmit)="onSubmit()"
              class="transfer-form"
            >
              <div class="form-field">
                <label for="recipient" class="form-label">
                  <i class="pi pi-user"></i>
                  Tài khoản người nhận <span class="required">*</span>
                </label>
                <div class="input-wrapper">
                  <input
                    id="recipient"
                    type="text"
                    formControlName="recipient"
                    placeholder="Nhập số tài khoản (16 chữ số) hoặc nickname"
                    class="transfer-input"
                    [class.error]="
                      transferForm.get('recipient')?.invalid &&
                      transferForm.get('recipient')?.touched
                    "
                  />
                </div>
                @if (
                  transferForm.get("recipient")?.invalid &&
                  transferForm.get("recipient")?.touched
                ) {
                  <div class="error-message">
                    <i class="pi pi-exclamation-triangle"></i>
                    @if (transferForm.get("recipient")?.errors?.["required"]) {
                      <span>Vui lòng nhập tài khoản người nhận</span>
                    }
                    @if (transferForm.get("recipient")?.errors?.["pattern"]) {
                      <span
                        >Vui lòng nhập số tài khoản 16 chữ số hoặc nickname 3-20
                        ký tự</span
                      >
                    }
                  </div>
                }
              </div>

              <!-- Recipient Info Card -->
              @if (recipientInfo) {
                <div class="recipient-info-card">
                  <!-- Animated background -->
                  <div class="card-bg-animation"></div>
                  
                  <!-- Header with enhanced design -->
                  <div class="recipient-header">
                    <div class="header-left">
                      <div class="recipient-avatar">
                        <div class="avatar-bg"></div>
                        <i class="pi pi-user-check"></i>
                        <div class="avatar-glow"></div>
                      </div>
                      <div class="header-text">
                        <h4 class="header-title">Thông tin người nhận</h4>
                        <p class="header-subtitle">Đã xác thực tài khoản</p>
                      </div>
                    </div>
                    <div class="header-right">
                      <div class="verification-badge">
                        <i class="pi pi-shield-check"></i>
                        <span>Verified</span>
                      </div>
                    </div>
                  </div>

                  <!-- Content with improved layout -->
                  <div class="recipient-content">
                    <div class="recipient-details">
                      <!-- Name with highlight -->
                      <div class="detail-item primary">
                        <div class="detail-icon">
                          <i class="pi pi-user"></i>
                        </div>
                        <div class="detail-content">
                          <span class="detail-label">Họ tên</span>
                          <span class="detail-value name-highlight">
                            {{ recipientInfo?.name || "N/A" }}
                          </span>
                        </div>
                      </div>

                    </div>
                  </div>

                  <!-- Footer with action -->
                  <div class="recipient-footer">
                    <div class="footer-info">
                      <i class="pi pi-info-circle"></i>
                      <span>Thông tin đã được xác thực bởi hệ thống</span>
                    </div>
                  </div>
                </div>
              }

              <!-- Loading state for recipient check -->
              @if (isCheckingRecipient) {
                <div class="recipient-loading">
                  <div class="loading-content">
                    <i class="pi pi-spin pi-spinner"></i>
                    <span>Đang tìm kiếm thông tin người nhận...</span>
                  </div>
                </div>
              }

              <!-- Error state for recipient not found -->
              @if (
                transferForm.get("recipient")?.touched &&
                transferForm.get("recipient")?.valid &&
                !recipientInfo &&
                !isCheckingRecipient &&
                transferForm.get("recipient")?.value
              ) {
                <div class="recipient-error">
                  <div class="error-content">
                    <i class="pi pi-exclamation-triangle"></i>
                    <span
                      >Không tìm thấy tài khoản người nhận. Vui lòng kiểm tra
                      lại thông tin.</span
                    >
                  </div>
                </div>
              }

              <div class="form-field">
                <label for="amount" class="form-label">
                  <i class="pi pi-money-bill"></i>
                  Số tiền chuyển <span class="required">*</span>
                </label>
                <div class="input-wrapper">
                  <input
                    id="amount"
                    type="text"
                    formControlName="amount"
                    placeholder="Nhập số tiền"
                    class="transfer-input amount-input"
                    [class.error]="
                      transferForm.get('amount')?.invalid &&
                      transferForm.get('amount')?.touched
                    "
                    (input)="onAmountInput($event)"
                    (blur)="onAmountBlur($event)"
                  />
                </div>
                @if (
                  transferForm.get("amount")?.invalid &&
                  transferForm.get("amount")?.touched
                ) {
                  <div class="error-message">
                    <i class="pi pi-exclamation-triangle"></i>
                    @if (transferForm.get("amount")?.errors?.["required"]) {
                      <span>Vui lòng nhập số tiền</span>
                    }
                    @if (transferForm.get("amount")?.errors?.["min"]) {
                      <span>Số tiền tối thiểu là 1,000 ₫</span>
                    }
                    @if (transferForm.get("amount")?.errors?.["max"]) {
                      <span>Số tiền tối đa là 100,000,000 ₫</span>
                    }
                    @if (transferForm.get("amount")?.errors?.["insufficient"]) {
                      <span>Số dư không đủ để thực hiện giao dịch</span>
                    }
                  </div>
                }
              </div>

              <div class="form-field">
                <label for="transName" class="form-label">
                  <i class="pi pi-comment"></i>
                  Nội dung chuyển khoản <span class="required">*</span>
                </label>
                <div class="input-wrapper">
                  <input
                    id="transName"
                    type="text"
                    formControlName="transName"
                    placeholder="Nhập nội dung chuyển khoản"
                    class="transfer-input"
                    maxlength="100"
                  />
                </div>
                <div class="char-count">
                  {{ transferForm.get("transName")?.value?.length || 0 }}/100 ký
                  tự
                </div>
              </div>

              <!-- Transaction Summary -->
              @if (transferForm.get("amount")?.value) {
                <div class="transaction-summary">
                  <h3 class="summary-title">Tóm tắt giao dịch</h3>
                  <div class="summary-content">
                    <div class="summary-item">
                      <span class="summary-label">Số tiền chuyển:</span>
                      <span class="summary-value negative">
                        -{{ transferForm.get("amount")?.value | currencyVnd }}
                      </span>
                    </div>
                    <div class="summary-item">
                      <span class="summary-label">Phí giao dịch:</span>
                      <span class="summary-value">0 ₫</span>
                    </div>
                    <div class="summary-divider"></div>
                    <div class="summary-item total">
                      <span class="summary-label">Tổng cộng:</span>
                      <span class="summary-value negative">
                        -{{ transferForm.get("amount")?.value | currencyVnd }}
                      </span>
                    </div>
                  </div>
                </div>
              }

              <!-- Submit Button -->
              <button
                type="submit"
                class="transfer-button"
                [disabled]="transferForm.invalid || isLoading"
              >
                @if (!isLoading) {
                  <i class="pi pi-check"></i>
                }
                @if (isLoading) {
                  <i class="pi pi-spin pi-spinner"></i>
                }
                <span>{{
                  isLoading ? "Đang xử lý..." : "Khởi tạo chuyển khoản"
                }}</span>
              </button>
            </form>
          </div>

          <div class="card-footer">
            <div class="info-message">
              <i class="pi pi-info-circle"></i>
              <span
                >Hệ thống sẽ gửi mã xác nhận 6 chữ số qua email để hoàn tất giao
                dịch</span
              >
            </div>
          </div>
        </div>
      </div>

      <!-- Info Panel -->
      <div class="info-section">
        <!-- Current Balance -->
        <div class="info-card balance-card">
          <div class="info-header">
            <div class="info-icon balance-icon">
              <i class="pi pi-wallet"></i>
            </div>
            <div class="info-content">
              <h3 class="info-title">Số dư hiện tại</h3>
              <p class="info-subtitle">Tài khoản của bạn</p>
            </div>
          </div>
          <div class="info-body">
            <div class="balance-amount">
              {{ currentBalance?.balance ?? 0 | currencyVnd }}
            </div>
          </div>
        </div>

        <!-- Transfer Info -->
        <div class="info-card details-card">
          <div class="info-header">
            <div class="info-icon details-icon">
              <i class="pi pi-info-circle"></i>
            </div>
            <div class="info-content">
              <h3 class="info-title">Thông tin chuyển khoản</h3>
              <p class="info-subtitle">Chi tiết giao dịch</p>
            </div>
          </div>
          <div class="info-body">
            <div class="info-items">
              <div class="info-item">
                <div class="item-icon">
                  <i class="pi pi-info-circle"></i>
                </div>
                <div class="item-content">
                  <h4 class="item-title">Giới hạn giao dịch</h4>
                  <p class="item-description">
                    Tối thiểu: 1,000 ₫<br />
                    Tối đa: 100,000,000 ₫
                  </p>
                </div>
              </div>

              <div class="info-item">
                <div class="item-icon">
                  <i class="pi pi-clock"></i>
                </div>
                <div class="item-content">
                  <h4 class="item-title">Thời gian xử lý</h4>
                  <p class="item-description">
                    Giao dịch được xử lý ngay lập tức sau khi xác nhận
                  </p>
                </div>
              </div>

              <div class="info-item">
                <div class="item-icon">
                  <i class="pi pi-shield"></i>
                </div>
                <div class="item-content">
                  <h4 class="item-title">Bảo mật</h4>
                  <p class="item-description">
                    Xác thực 2 lớp qua email để đảm bảo an toàn
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<p-confirmDialog></p-confirmDialog>
